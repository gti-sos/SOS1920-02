<script>
    import {
        onMount
    } from "svelte";
 
    import Table from "sveltestrap/src/Table.svelte";
    import Button from "sveltestrap/src/Button.svelte";
 
    let tourism = [];
    let newTourism = {
        province: "",
        year: 0.0,
        traveller: 0.0,
		overnightstay: 0.0,
		averagestay: 0.0
		
    };
 
    onMount(getTourism);
 
    async function getTourism() {
 
        console.log("Fetching rural-tourism-stats...");
        const res = await fetch("/api/v1/rural-tourism-stats");
 
        if (res.ok) {
            console.log("Ok:");
            const json = await res.json();
            tourism = json;
            console.log("Received " + tourism.length + " rural-tourism-stats.");
        } else {
            console.log("ERROR!");
        }
    }
 
  	async function insertTourism() {
	  
        console.log("Inserting new data..." + JSON.stringify(newTourism));
 
        const res = await fetch("/api/v1/rural-tourism-stats", {
            method: "POST",
            body: JSON.stringify(newTourism),
            headers: {
                "Content-Type": "application/json"
            }
        }).then(function (res) {
            getTourism();
        });
 
    }
    async function deleteTourism(province, year) {
        const res = await fetch("/api/v1/rural-tourism-stats/" + province +"/" + year, {
            method: "DELETE"
        }).then(function (res) {
            getTourism();
        });
    }
	async function deleteAllTourism() {
        const res = await fetch("/api/v1/rural-tourism-stats/", {
            method: "DELETE"
        }).then(function (res) {
            getTourism();
        });
    }
	async function loadInitialData() {
        const res = await fetch("/api/v1/rural-tourism-stats/loadInitialData", {
            method: "GET"
        }).then(function (res) {
            getTourism();
        });
    }
</script>
 
<main>
	<h2>Turismo rural</h2>
 	<div style="text-align:center;padding-bottom: 3%;">
		<Button outline  color="primary" on:click={loadInitialData}>Inicializar</Button>
		<Button outline  color="danger" on:click={deleteAllTourism}><i class="fa fa-trash" aria-hidden="true"></i> Eliminar todo</Button>
	</div>
	
    {#await tourism}
        Loading datas...
    {:then tourism}
        <Table bordered>
            <thead>
                <tr>
                    <th>Provincia</th>
                	<th>Año</th>
                	<th>Viajero</th>
                	<th>Pernoctación</th>
					<th>Estancia media</th>
					<th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {#each tourism as tou}
                    <tr>
						<td>
                        	<a href="#/rural-tourism-stats/{tou.province}/{tou.year}">{tou.province}</a>
						</td>
                        <td>{tou.year}</td>
                        <td>{tou.traveller}</td>
						<td>{tou.overnightstay}</td>
                        <td>{tou.averagestay}</td>
                        <td><Button outline color="danger" on:click="{deleteTourism(tou.province,tou.year)}"><i class="fa fa-trash" aria-hidden="true"></i> Eliminar</Button></td>
                    </tr>
                {/each}
            </tbody>
        </Table>
		<h3>Añadir nuevo dato:</h3>
		<Table style="background-color:#EAEEF0;">
			<tr>
				<td><strong>Provincia:</strong> <input bind:value="{newTourism.province}"></td>
				<td><strong>Año:</strong> <input type="number" bind:value="{newTourism.year}"></td>
				<td><strong>Viajero:</strong> <input type="number" bind:value="{newTourism.traveller}"></td>
				<td><strong>Pernoctación:</strong> <input type="number" bind:value="{newTourism.overnightstay}"></td>
				<td><strong>Estancia media:</strong> <input type="number" bind:value="{newTourism.averagestay}"></td>
				<td><strong>Acción:</strong> <Button color="primary" on:click={insertTourism}>Añadir</Button> </td>
			</tr>
		</Table>
	
    {/await}
 
 
</main>